<html> <head>
<title>Soaplab2: Admin tools</title>

<link rel="shortcut icon" href="images/favicon.ico" >
<link rel="icon" href="images/animated_favicon1.gif" type="image/gif" >
<link rel="stylesheet" href="images/stylesheet.css" type="text/css">

</head>

<body>
<h1>Service provider's tools</h1>

<img class="motto-img" src="images/motto-administrative-tools.jpg" border=0 align="left"/>

Soaplab2 provides several command-line tools that help service
providers and developers to explore various parts of the Soaplab2
infrastructure. The ultimate goal, sometimes in the future, is to
integrate these and other tools into a Soaplab GUI Dashboard. <p>

<br clear="all"/>


<div>
<dl>
  <dt> <a href="#tools">Exploring tools</a></dt>
       <dl>
	 <dt> <a href="#start">How to start the tools</a>
	 <dt> <a href="#config">ExploreConfig</a>
	 <dt> <a href="#storage">ExploreStorage</a>
	 <dt> <a href="#params">ExploreParameters</a>
       </dl>
  <dt> <a href="#monitor">Monitoring Soaplab servers using Jconsole</a></dt>
       <dl>
	 <dt> <a href="#local">Monitoring locally</a>
	 <dt> <a href="#remote">Monitoring remotely</a>
       </dl>
</dl> <p>
</div>

<a name="tools"></a>
<h2> Exploring tools </h2>

<a name="start"></a>
<h3> How to start the tools </h3>

They are command-line tools and most of them (if not all) are started
using a single script <tt>build/run/run-any-client</tt> that gets as
its first parameter a class name representing a particular tool. <p>

This script is generated by Ant when Soaplab2 is being built. The
original source is in the <tt>src/etc/scripts</tt> directory. Ant adds
there the current Soaplab2 directory, and log4j configuration
property. <p>

The best way how to start them is to call them with a <tt>-help</tt>
option. <p>


<a name="config"></a>
<h3>ExploreConfig </h3>

<pre class="script">
build/run/run-any-client org.soaplab.admin.ExploreConfig -help
</pre>

This is a command-line tool that explores and shows Soaplab2
configuration. For example, to list all used configuration sources, in
the order of precedence, type:

<pre class="script">
build/run/run-any-client org.soaplab.admin.ExploreConfig -lf
</pre>

The result (as run from a BioinfoGRID plug-in) shows names of files
and number of their properties:

<pre class="sscript">
Using property resources (in this order):
-----------------------------------------
1: (   50) Java System Properties
2: (   12) /home/senger/bioinfogrid-plugin/build/classes/bioinfogrid.properties
3: (    4) /home/senger/soaplab2/build/classes/soaplab.properties
4: (empty) Directly added properties (no config file)
</pre>

It can also list all available properties, including or excluding the
System properties, or show only the named properties. <p>

One can also test what happens (which properties are used) when a new
configuration file is added by using option <tt>-f
&lt;property-file&gt;</tt>.

<a name="storage"></a>
<h3>ExploreStorage</h3>

<pre class="script">
build/run/run-any-client org.soaplab.admin.ExploreStorage -help
</pre>

This is a command-line tool that explores, shows and controls the
contents of one or more storage handlers. A storage handler stores
Soaplab2 results and retrieve them back on request. <p>

This tools allows to access any number of such storage elements,
either as a set (so you do not know particularly which handler has
just been contacted), or to access a particular element. <p>

Without any parameters, it just shows what persistent storage elements
are available, which class represents them, and perhaps some
additional information (like where is the persistent storage located):

<pre class="script">
build/run/run-any-client org.soaplab.admin.ExploreStorage

Available storage:
------------------
org.soaplab.services.storage.FileStorage
        Local file system storage: /home/senger/soaplab2/RESULTS
</pre>

The options <tt>-file</tt> and <tt>-db</tt> (and perhaps others, in the
future) direct to explore only specified storage type. Without these
options, the whole set of available storage elements is explored. <p>

The Soaplab2 results are always kept grouped by Jobs they created
them. The Job Ids are, therefore, used to access particular
results. The option <tt>-l</tt> lists IDs of all currently stored
jobs:

<pre class="script">
build/run/run-any-client org.soaplab.admin.ExploreStorage -l
</pre>
<pre class="sscript">
[testing.echo]31174563.10f17894582.-8000
[testing.echo]-2f8932c2.10f10946730.-7fff
[testing.helloworld]791f4392.10f030ae679.-8000
[classic.helloworld]-76d9da02.10f0f4b3003.-8000
...
</pre>

If there are no existing jobs, you can always use the <tt>-run</tt>
option to create and run a testing job (note that this is a
<em>testing</em> job, so this option is not here to run the real jobs,
not at all)::

<pre class="script">
build/run/run-any-client org.soaplab.admin.ExploreStorage -run
</pre>

<pre class="sscript">
Creating and running a job:
---------------------------
Job state before run: [testing.service]-d535e5d.10f2b35b671.-8000 (CREATED)
        created: 27-Nov-2006 20:57:57 (Europe/London)
        started: 01-Jan-1970 00:59:59 (Europe/London)
        ended:   01-Jan-1970 00:59:59 (Europe/London)
        elapsed: -1
        last event: &lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;analysis_event timestamp="Mon Nov 27 20:57:57 GMT 2006"&gt;
  &lt;state_changed previous_state="UNKNOWN" new_state="CREATED" /&gt;
&lt;/analysis_event&gt;

Job state after run: [testing.service]-d535e5d.10f2b35b671.-8000 (COMPLETED (0))
        created: 27-Nov-2006 20:57:57 (Europe/London)
        started: 27-Nov-2006 20:57:57 (Europe/London)
        ended:   27-Nov-2006 20:57:58 (Europe/London)
        elapsed: 111
        last event: &lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;analysis_event timestamp="Mon Nov 27 20:57:58 GMT 2006"&gt;
  &lt;state_changed previous_state="RUNNING" new_state="COMPLETED" /&gt;
&lt;/analysis_event&gt;
</pre>

The same kind of information, you can get for an individual job, using
the <tt>-job &lt;job-id&gt;</tt> and <tt>-i</tt> options.  Also the
option <tt>-ri</tt> may be useful to find how big are the stored
results. <p>

Particularly useful are options for clearing storage. They can be used
in cron jobs to clean old jobs and their results:

<pre class="sscript">
Removing jobs from the storage(s):

   -clean &lt;job-id&gt;  ... remove given job
   -cleanall        ... remove all jobs

   -cleanlike &lt;pattern&gt;
      Remove jobs whose IDs contain given pattern.
      For example: -rp testing.helloworld

   -cleanfrom &lt;from-date&gt;
      Remove jobs updated after &lt;from-date&gt;. The format of
      &lt;from-date&gt; is 'yyyy-MM-dd HH:mm:ss'.

      Or, it can be a number (with or without a minus sign)
      meaning "last jobs for the given number". The number is
      in milliseconds unless it ends with one of the following
      characters: 's', 'm', 'h', 'd', 'w', or 'M'.

      Examples: -rf 2004-04-30 14:10:00
                -rf -20000
                -rf -3d
                -rf -4w

   -cleanto &lt;to-date&gt;
      Remove jobs updated before &lt;to-date&gt;. The format is
      the same as for &lt;from-date&gt;. For example:

      -f -2d -t -1d   ... jobs from a day before yesterday
</pre> <p>

<a name="params"></a>
<h3>ExploreParameters</h3>

<pre class="script">
build/run/run-any-client org.soaplab.admin.ExploreParameters -help
</pre>

This is a command-line tool that explores and tests command-line
parameters created from service metadata and user inputs. <p>

This tool is useful when a service provider creates an ACD file for a
new service around a command-line analysis. Before running the
analysis, the tool explores what command-line Soaplab2 is going to
create for the analysis. <p>

The ultimate source of information about the service metadata and
about creating ACD metadata files is the <a
href="MetadataGuide.html">metadata guide</a>. You may consider to read
it before exploring parameters with this tool. <p>

<pre class="sscript">
A mandatory option is a service name whose parameters are going to be
explored:

  -name &lt;service-name&gt;

Exploring metadata is the same as in CmdLineClient. It is included
here for convenience because to know names of input/output data may be
handy:

  -i  ... show names of analysis inputs
  -ii ... show names and attributes of analysis inputs
  -o  ... show names of possible results
  -oo ... show names and types of possible results

Existing metadata of the analysis being explored can be changed
on-the-fly (simulating the change of the ACD description file without
a need to do so manually and generate the whole XML metadata file
again). The following changes are possible:

  -m &lt;method-template&gt;
     global template substituing
        comments: "method XXXX"
     in the application section of the ACD file

  -m&lt;input_name&gt; &lt;parameter-method-template&gt;
  -m_&lt;input_name&gt; &lt;parameter-method-template&gt;
     substituting template for individual parameters

  -e&lt;input_name&gt;
  -e_&lt;input_name&gt;
     adding option "envar" to individual parameters
     (which measn that the parameter does not appear on the
      command-line but it creates an environment property)

The main output is how a command-line would look like, and what
environment properties would be created. This is a default behaviour
unless -arg option is given:

  -arg  ... show how individual parameters will be created

All remaining options are input data (values for parameters that will
constitued the analysis command-line). The names can be found using
option -i. The recognized formats are:

  &lt;input-name&gt; &lt;input-value&gt;
  &lt;input-name&gt; :&lt;input-value&gt;
     a value starting with ':' is treated as a file name
     and the contents of this file is used as an input
  -&lt;input-name&gt;
     can be used for boolean parameters and it means
     the same as:
       &lt;input-name&gt; true
</pre>


<p>

<a name="monitor"></a>
<h2>Monitoring Soaplab servers using Jconsole</h2>

<p> Using Java <a
href="http://java.sun.com/javase/6/docs/technotes/tools/share/jconsole.html">
Jconsole</a> tool which is distributed as part of the recent releases
of JDK you can monitor your Soaplab Server's memory, thread and CPU
usage and can find other useful information that would help you
understand current status of your server.  </p>

You can use Jconsole to access local or remote Soaplab servers. <p>

<a name="local"></a>
<h3> Monitoring locally </h3>


<p> If your Tomcat server is started using Java6 then local Jconsole
access for the same user that started the server is automatically
granted. However when using Java5 Tomcat server needs to be started
with the following option (Java property) that then would allow local
Jconsole access to the server.  </p>

<pre class="code">
com.sun.management.jmxremote = true
</pre>
<p>
The easiest way how to set this property is to use an environment
variable <tt>JAVA_OPTS</tt> when starting Tomcat. For example,
directly in the <tt>setenv.sh</tt> file under your <tt>${tomcat.home}/bin</tt>
directory as in the following example:</p>

<pre class="code">
if [ "$1" = "start" ] ; then
  export JAVA_OPTS="-Dcom.sun.management.jmxremote=true"
fi
</pre>
<p> Above, the first line is to make sure that JMX options are used
only when starting the tomcat server but not when stopping the server.

Then run:

<pre class="script">
jconsole
</pre>

When jconsole starts you should see your process in the 'Local Process'
list and can select and start monitoring for it.

<a name="remote"></a>
<h3> Monitoring remotely </h3>

<p> In order to allow remote Jconsole access to your Soaplab server
you should set more JMX parameters (i.e. more Java properties). A
practical way of setting these parameters would be to change the
<tt>setenv.sh</tt> file under your <tt>${tomcat.home}/bin</tt>
directory as in the following example </p>

<pre class="code">
if [ "$1" = "start" ] ; then
  export JAVA_OPTS="-Dcom.sun.management.jmxremote.port=8070 \
                    -Dcom.sun.management.jmxremote.ssl=false \
                    -Dcom.sun.management.jmxremote.authenticate=false"
fi
</pre>

You can then start your local Jconsole process by specifying
the hostname of your remote server and the JMX port number you selected
when starting the server.  
<pre class="script">
jconsole mysoaplabserver.net:8070
</pre>
<p>When jconsole started it will connect to server automatically.
You should see a new panel opened for each connected process
similar to the following.<p/>

<img src="images/jconsole.png"/>
<p>
Here you can see how your Soaplab server is using memory over time.
The number of threads started can give you an estimate of how many jobs
has been started on the server. Similarly 'Peak' number of threads would
help you estimate how many concurrent requests were made. 
<p> 
Usufeul Jconsole links:  
<ul>
<li>
<a href="http://java.sun.com/developer/technicalArticles/J2SE/monitoring/">Monitoring and Managing Java SE 6 Platform Applications</a>
</li>
<li><a href="http://java.sun.com/javase/6/docs/technotes/guides/management/jconsole.html">Using JConsole</a>
</ul>

<iframe id="maintoc" src="TOC.html" scrolling="auto"></iframe>

<div align=right><font size=-2>
<!-- hhmts start -->
Last modified: Mon Feb  4 17:13:08 2008
<!-- hhmts end -->
</font></div>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1011961-1";
urchinTracker();
</script>
</body> </html>
